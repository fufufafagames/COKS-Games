<%- include('../layouts/header', { title: title }) %>
<%- include('../partials/navbar') %>

<div class="container mt-5">
    <h2 class="text-white mb-4"><i class="fas fa-history"></i> Payment Status</h2>
    
    <% if (transactions.length === 0) { %>
        <div class="alert alert-info">
            You haven't made any purchases yet.
        </div>
    <% } else { %>
        <div class="table-responsive">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Game</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% transactions.forEach(trx => { %>
                        <tr>
                            <td><%= new Date(trx.created_at).toLocaleDateString() %> <%= new Date(trx.created_at).toLocaleTimeString() %></td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <img src="<%= trx.thumbnail_url %>" alt="thumb" style="width: 40px; height: 40px; object-fit: cover; margin-right: 10px; border-radius: 4px;">
                                    <%= trx.game_title %>
                                </div>
                            </td>
                            <td>Rp <%= parseInt(trx.amount).toLocaleString('id-ID') %></td>
                            <td>
                                <% if (trx.status === 'success') { %>
                                    <span class="badge bg-success">Success</span>
                                <% } else if (trx.status === 'pending') { %>
                                    <span class="badge bg-warning text-dark">Waiting</span>
                                <% } else if (trx.status === 'challenge') { %>
                                    <span class="badge bg-info">Processing</span>
                                <% } else { %>
                                    <span class="badge bg-danger">Error/Failed</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (trx.status === 'success') { %>
                                    <a href="/games/<%= trx.game_slug %>" class="btn btn-sm btn-aqua">Play/Download</a>
                                <% } else if (trx.status === 'pending') { %>
                                    <!-- Use Snap again if possible, or just details page -->
                                    <a href="/payment/<%= trx.game_slug %>/details" class="btn btn-sm btn-outline-warning">Pay Now</a>
                                <% } %>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } %>
</div>

<%- include('../layouts/footer') %>
